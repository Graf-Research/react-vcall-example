# VCall
Easy Video Streaming Implementation

## Usage

```tsx
const initial_value = {
  user_id: my_user_id,
  room: `3f014cb2-e8ca-4589-a0b7-b909d683289e`, // this value should be fetched from API
  name: 'sample-name',
  is_muted: true,
  is_show_camera: false,
  is_share_screen: false
};
const listener = {
  onReady: () => {},
  onUserRequestToJoinRoom: (data, accept, reject) => {},
  onRecordingStarted: () => {},
  onRecordingEnded: () => {},
  onWaitingRoom: () => {},
  onSharingScreenStarted: () => {},
  onSharingScreenEnded: () => {}
}

const { streams, action } = useVCall(initial_value, listener);
```

## Parameters

- Initial Value
- Listener

### Initial Value
```tsx
{
  user_id: my_user_id,
  room: `3f014cb2-e8ca-4589-a0b7-b909d683289e`, // this room should be fetched from API
  name: 'sample-name',
  is_muted: true,
  is_show_camera: false,
  is_share_screen: false
}
```
Key|Description|Default Value|Example Value
---|-----------|-------------|-------------
user_id|Current active User ID||`12`, `"123e4567-e89b-12d3-a456-426614174000"`
room|Room UUID, generated by VCall Service||`3f014cb2-e8ca-4589-a0b7-b909d683289e`
name|Current active User Name||John Smith
is_muted|Intial microphone value muted/unmuted|true|true
is_show_camera|Intial camera value show/hide|false|false
is_share_screen|Intial sharing screen value share/stop|false|false

### Listener
```tsx
{
  onReady: () => {},
  onUserRequestToJoinRoom: (data: UserRequestJoinResponse, accept: () => void, reject: () => void) => {},
  onRecordingStarted: () => {},
  onRecordingEnded: () => {},
  onWaitingRoom: () => {},
  onSharingScreenStarted: () => {},
  onSharingScreenEnded: () => {}
}
```
Key|Description|Params
---|-----------|------
onReady|Callback on streaming ready (on joined into meeting room)|-
onUserRequestToJoinRoom|Callback on a user request to join room (only triggered to room admin)|`(` `data: UserRequestJoinResponse,`<br/>`accept: () => void,`<br/>`reject: () => void` `): void`
onRecordingStarted|Callback on recording started|-
onRecordingEnded|Callback on recording ended|-
onWaitingRoom|Callback on user waiting for admin approval join|-
onSharingScreenStarted|Callback on share screen successfully started|-
onSharingScreenEnded|Callback on share screen stopped|-

## Return Value

- List of Stream
- VCall Action

```tsx
interface UserSocketData {
  user_id: string
  room: string
  name: string
  is_muted: boolean
  is_show_camera: boolean
  is_creator: boolean
  is_sharing_screen_user: boolean
}

interface UserMediaStream {
  user_id: string
  manifest: UserSocketData
  setAudioAnalyser(interval: number, callback: (value: number) => void): void
  ms: MediaStream
}

interface ReturnValue {
  streams: UserMediaStream[];
  action: {
    showCamera: () => void
    hideCamera: () => void
    startMic: () => void
    stopMic: () => void
    startShareScreen: () => void
    stopShareScreen: () => void
    startRecording: () => void
    stopRecording: () => void
  }
}
```

### Return Value
Key|Type|Example Value
---|-----------|-------------
streams|UserMediaStream[]|All active user streams. Actual user and sharing screen stream will be on separated stream, use indicator `is_sharing_screen_user`.
action|VCall Action|see example above

### User Socket Data
Key|Type|Description|Example Value
---|----|-----------|-------------
user_id|string UUID|User's ID|`12`, `"123e4567-e89b-12d3-a456-426614174000"`
room|string UUID|Room UUID|`3f014cb2-e8ca-4589-a0b7-b909d683289e`
name|string|User's Name|John Smith
is_muted|boolean|Microphone value muted/unmuted|true
is_show_camera|boolean|Camera value show/hide|false
is_creator|boolean|On admin value = true, participant value = false|false
is_sharing_screen_user|boolean|Indicator of stream, is it a sharing screen user or actual user|false

### User Media Stream
<table>
<tr>
<th>
Key
</th>
<th>
Type
</th>
<th>
Description
</th>
<th>
Example Value / Usage
</th>
</tr>
<tr>
<td>
user_id
</td>
<td>
string
</td>
<td>
User's ID
</td>
<td>
`12`, `"123e4567-e89b-12d3-a456-426614174000"`
</td>
</tr>
<tr>
<td>
manifest
</td>
<td>
UserSocketData
</td>
<td>
User's data detail
</td>
<td>
-
</td>
</tr>
<tr>
<td>
setAudioAnalyser
</td>
<td>
function
</td>
<td>
Assign user's sound level listener
</td>
<td>

```tsx
const time_interval: number = 50; // milliseconds
function soundLevel(level: number) {
  console.log(`current sound level ${level}`);
}

// function soundLevel will be called every 50 millisecond
setAudioAnalyser(time_interval, soundLevel);
```
</td>
</tr>
<tr>
<td>
ms
</td>
<td>
MediaStream
</td>
<td>
Media stream instance
</td>
<td>
see <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream" target="_blank">MediaStream</a>
</td>
</tr>
</table>

### VCall Action
Function|Parameters|Description
--------|-----------|-------------
showCamera|no params|Trigger show camera
hideCamera|no params|Trigger hide camera
startMic|no params|Trigger start microphone
stopMic|no params|Trigger stop microphone
startShareScreen|no params|Trigger start sharing screen
stopShareScreen|no params|Trigger stop sharing screen
startRecording|no params|Initialize recording
stopRecording|no params|Stop recording
